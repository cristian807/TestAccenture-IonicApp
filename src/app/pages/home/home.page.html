
<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-title>Mis Tareas</ion-title>
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    
    <ion-title>Mis Tareas</ion-title>
    
    <ion-buttons slot="end">
      <ion-button *ngIf="categoriesEnabled" routerLink="/categories">
        <ion-icon slot="icon-only" name="folder-outline"></ion-icon>
      </ion-button>
      
      <ion-button routerLink="/settings">
        <ion-icon slot="icon-only" name="settings-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  
  <ion-toolbar *ngIf="categoriesEnabled">
    <ion-item lines="none">
      <ion-icon name="filter-outline" slot="start"></ion-icon>
      <ion-select 
        [(ngModel)]="selectedCategoryId" 
        (ionChange)="onCategoryFilterChange()"
        placeholder="Filtrar por categoría"
        interface="popover">
        <ion-select-option [value]="null">Todas las tareas</ion-select-option>
        <ion-select-option 
          *ngFor="let category of categories" 
          [value]="category.id">
          {{ category.name }}
        </ion-select-option>
      </ion-select>
    </ion-item>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  
  <div class="add-task-section">
    <ion-item class="new-task-input">
      <ion-input 
        [(ngModel)]="newTaskTitle" 
        placeholder="¿Qué necesitas hacer?"
        (keyup.enter)="addTask()">
      </ion-input>
    </ion-item>
    
    <ion-item *ngIf="categoriesEnabled" lines="none" class="category-selector">
      <ion-select 
        [(ngModel)]="newTaskCategoryId" 
        placeholder="Categoría (opcional)"
        interface="popover">
        <ion-select-option value="">Sin categoría</ion-select-option>
        <ion-select-option 
          *ngFor="let category of categories" 
          [value]="category.id">
          {{ category.name }}
        </ion-select-option>
      </ion-select>
      
      <ion-button slot="end" (click)="addTask()" fill="solid">
        <ion-icon name="add-outline"></ion-icon>
        Agregar
      </ion-button>
    </ion-item>
    
    <ion-button 
      *ngIf="!categoriesEnabled" 
      expand="block" 
      (click)="addTask()" 
      class="ion-margin-top">
      <ion-icon name="add-outline" slot="start"></ion-icon>
      Agregar Tarea
    </ion-button>
  </div>
  
  <div class="task-counter" *ngIf="tasks.length > 0">
    <ion-text color="medium">
      {{ tasks.length }} tarea(s) 
      <span *ngIf="selectedCategoryId">
        en "{{ getCategoryName(selectedCategoryId) }}"
      </span>
    </ion-text>
  </div>
  
  <ion-list *ngIf="tasks.length > 0">
    <ion-item-sliding *ngFor="let task of tasks; trackBy: trackByTaskId">
      
      <ion-item [class.task-completed]="task.completed">
        <ion-checkbox 
          slot="start" 
          [checked]="task.completed"
          (ionChange)="toggleComplete(task)">
        </ion-checkbox>
        
        <ion-label>
          <h2>{{ task.title }}</h2>
          
          <ion-badge 
            *ngIf="categoriesEnabled && task.categoryId"
            [style.background-color]="getCategoryColor(task.categoryId)"
            class="category-badge">
            {{ getCategoryName(task.categoryId) }}
          </ion-badge>
        </ion-label>
        
        <ion-icon 
          *ngIf="task.completed" 
          name="checkmark-done-outline" 
          color="success" 
          slot="end">
        </ion-icon>
      </ion-item>
      
      <ion-item-options side="end">
        <ion-item-option color="danger" (click)="deleteTask(task)">
          <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
        </ion-item-option>
      </ion-item-options>
      
    </ion-item-sliding>
  </ion-list>
  
  <div class="empty-state" *ngIf="tasks.length === 0">
    <ion-icon name="list-outline"></ion-icon>
    <h2>No hay tareas</h2>
    <p>
      <span *ngIf="selectedCategoryId">
        No hay tareas en esta categoría.
      </span>
      <span *ngIf="!selectedCategoryId">
        ¡Agrega tu primera tarea arriba!
      </span>
    </p>
  </div>

</ion-content>
