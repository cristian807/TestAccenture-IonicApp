<!-- 
  P치gina Principal - Lista de Tareas
  
  Esta es la pantalla principal de la aplicaci칩n donde se muestran
  todas las tareas y se pueden agregar nuevas.
-->

<!-- Header / Barra superior -->
<ion-header>
  <ion-toolbar color="primary">
    <ion-title>游늶 Mis Tareas</ion-title>
    
    <!-- Botones de navegaci칩n -->
    <ion-buttons slot="end">
      <!-- Bot칩n de categor칤as (solo si est치 habilitado) -->
      <ion-button *ngIf="categoriesEnabled" routerLink="/categories">
        <ion-icon slot="icon-only" name="folder-outline"></ion-icon>
      </ion-button>
      
      <!-- Bot칩n de configuraci칩n -->
      <ion-button routerLink="/settings">
        <ion-icon slot="icon-only" name="settings-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  
  <!-- Barra de filtro por categor칤a (solo si est치 habilitado) -->
  <ion-toolbar *ngIf="categoriesEnabled">
    <ion-item lines="none">
      <ion-icon name="filter-outline" slot="start"></ion-icon>
      <ion-select 
        [(ngModel)]="selectedCategoryId" 
        (ionChange)="onCategoryFilterChange()"
        placeholder="Filtrar por categor칤a"
        interface="popover">
        <ion-select-option [value]="null">Todas las tareas</ion-select-option>
        <ion-select-option 
          *ngFor="let category of categories" 
          [value]="category.id">
          {{ category.name }}
        </ion-select-option>
      </ion-select>
    </ion-item>
  </ion-toolbar>
</ion-header>

<!-- Contenido principal -->
<ion-content class="ion-padding">
  
  <!-- Secci칩n para agregar nueva tarea -->
  <div class="add-task-section">
    <ion-item class="new-task-input">
      <ion-input 
        [(ngModel)]="newTaskTitle" 
        placeholder="쯈u칠 necesitas hacer?"
        (keyup.enter)="addTask()">
      </ion-input>
    </ion-item>
    
    <!-- Selector de categor칤a para nueva tarea (si est치 habilitado) -->
    <ion-item *ngIf="categoriesEnabled" lines="none" class="category-selector">
      <ion-select 
        [(ngModel)]="newTaskCategoryId" 
        placeholder="Categor칤a (opcional)"
        interface="popover">
        <ion-select-option value="">Sin categor칤a</ion-select-option>
        <ion-select-option 
          *ngFor="let category of categories" 
          [value]="category.id">
          {{ category.name }}
        </ion-select-option>
      </ion-select>
      
      <ion-button slot="end" (click)="addTask()" fill="solid">
        <ion-icon name="add-outline"></ion-icon>
        Agregar
      </ion-button>
    </ion-item>
    
    <!-- Bot칩n de agregar (si categor칤as deshabilitadas) -->
    <ion-button 
      *ngIf="!categoriesEnabled" 
      expand="block" 
      (click)="addTask()" 
      class="ion-margin-top">
      <ion-icon name="add-outline" slot="start"></ion-icon>
      Agregar Tarea
    </ion-button>
  </div>
  
  <!-- Contador de tareas -->
  <div class="task-counter" *ngIf="tasks.length > 0">
    <ion-text color="medium">
      {{ tasks.length }} tarea(s) 
      <span *ngIf="selectedCategoryId">
        en "{{ getCategoryName(selectedCategoryId) }}"
      </span>
    </ion-text>
  </div>
  
  <!-- Lista de tareas -->
  <ion-list *ngIf="tasks.length > 0">
    <!-- Cada tarea es deslizable para mostrar opciones -->
    <ion-item-sliding *ngFor="let task of tasks; trackBy: trackByTaskId">
      
      <!-- Item de la tarea -->
      <ion-item [class.task-completed]="task.completed">
        <!-- Checkbox para marcar como completada -->
        <ion-checkbox 
          slot="start" 
          [checked]="task.completed"
          (ionChange)="toggleComplete(task)">
        </ion-checkbox>
        
        <!-- Informaci칩n de la tarea -->
        <ion-label>
          <h2>{{ task.title }}</h2>
          
          <!-- Badge de categor칤a (si tiene y est치 habilitado) -->
          <ion-badge 
            *ngIf="categoriesEnabled && task.categoryId"
            [style.background-color]="getCategoryColor(task.categoryId)"
            class="category-badge">
            {{ getCategoryName(task.categoryId) }}
          </ion-badge>
        </ion-label>
        
        <!-- Icono de completado -->
        <ion-icon 
          *ngIf="task.completed" 
          name="checkmark-done-outline" 
          color="success" 
          slot="end">
        </ion-icon>
      </ion-item>
      
      <!-- Opciones al deslizar (borrar) -->
      <ion-item-options side="end">
        <ion-item-option color="danger" (click)="deleteTask(task)">
          <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
        </ion-item-option>
      </ion-item-options>
      
    </ion-item-sliding>
  </ion-list>
  
  <!-- Estado vac칤o - cuando no hay tareas -->
  <div class="empty-state" *ngIf="tasks.length === 0">
    <ion-icon name="list-outline"></ion-icon>
    <h2>No hay tareas</h2>
    <p>
      <span *ngIf="selectedCategoryId">
        No hay tareas en esta categor칤a.
      </span>
      <span *ngIf="!selectedCategoryId">
        춰Agrega tu primera tarea arriba!
      </span>
    </p>
  </div>

</ion-content>
